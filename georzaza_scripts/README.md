# 1. How to run


Copy/move the `georzaza_scripts` inside your go-ethereum folder. Assuming you are inside the 
go-ethereum folder you can then copy-paste those commands one by one to your terminal.

```
# clean up previous output folder as we will generate a new one.
rm -rf georzaza_results 

# cd into the scripts directory
cd georzaza_scripts

# give execution rights to the run.sh script
chmod +x run.sh
./run.sh

# cd into a temporary folder generated by the above script
cd ../georzaza_results

# Assign a complicated command's output to the variable temp. 
# The command makes use of the current folder structure to produce the result
# Copy and paste as one-liner

temp=$(echo "CommonLines File1 File2 File1#Lines File2#Lines" && for file in `find . -type f`; do echo -e `cat $file | awk NF | wc -l` "\t" ${${file:2}%/*}.go "\t" ${${file:2}#*/}.go "\t" `echo ../${${file:2}%/*}.go | sed --expression='s/-/\//g' | xargs cat | wc -l` "\t" `echo ../${${file:2}#*/}.go | sed --expression='s/-/\//g' | xargs cat | wc -l`; done | sort -nrk1 | sed --expression='s/-/\//g')


# generate the report (contents of the temp variable) as a file. Exclude any *_test.go files
echo && echo $temp | column -t --output-separator="  " | grep -v "_test\.go\>" > ../georzaza_output

# cd back into go-ethereum folder
cd ../

# clean up
rm -rf find_candidate_same_files.py common_lines.sh
```

The above will generate a file named `georzaza_output` with the results. 
Here are the expected first lines of the file:
```
CommonLines  File1                        File2                         File1#Lines  File2#Lines
255          natupnp.go                   p2p/natupnp.go                338          341
91           peer.go                      p2p/peer.go                   881          462
86           cmd/ethereum/flags.go        cmd/mist/flags.go             120          129
80           trie/trie.go                 ptrie/trie.go                 631          312
57           cmd/ethereum/main.go         cmd/mist/main.go              135          115
43           trie/iterator.go             ptrie/iterator.go             143          115
42           p2p/client_identity.go       wire/client_identity.go       63           56
41           core/vm_env.go               xeth/vm_env.go                61           65
40           peer.go                      whisper/peer.go               881          128
```

The first line reads:  
There are **255** lines of the `natupnp.go` file that are also in the `p2p/natupnp.go` file. The `natupnp.go` file has **338** lines in total and the `p2p/natupnp.go` file **341**. Note that empty lines are not included as common lines (but lines containing e.g. only a ")" are included). 

<br>

# 2. Results explanations

<br>


# 3. `georzaza_scripts` folder contents explained

## 3.1 Core Files

<br>

- ###  `find_candidate_same_files.py`:

  Gets all the current folder's files recursively and for any (2 or more) same filenames under 
different directories populates a script named as `common_lines.sh` with commands that will find and print the same lines of the files.

  The generated script will contain commands that print the same number of lines between any 2 filenames that are   
  the same but are saved under different filepaths, e.g. for files `core/filter.go` and `event/filter/filter.go`.  

  The results will be saved under the folder `georzaza_results`.  
  <br>
  Example:  

  For files `core/filter.go`  and  `event/filter/filter.go` a folder named `core_filter` will be generated.  
  This folder will contain a file named `event-filter-filter`.  Notice that the extension `.go` is gone and and `/` character has been replaced with a dash `-`.  
  The `event-filter-filter` file's  contents will be the output of the command  
  `awk 'NR==FNR{arr[$0];next} $0 in arr' core/filter.go event/filter/filter.go`  
  which prints the number of lines of the `core/filter.go` that are present in the file `event/filter/filter.go`  

  Note that for any 2 files with the same filename we only check them once. E.g. we will `check core/filter.go` 
  against `event/filter/filter.go` but not the other way around.

<br>


- ### `common_lines.sh`:

  The shell script that gets generated from the above python script. Explanation above.

  <br>


- ### `run.sh`
  A simple script, you can easily understand it's contents.
 

<br>
<br>


## 3.2 Old, not-used, files

- ### `other/filenames`: 

  Contains all the filenames of the go-ethereum-0.7.10.  
  This file was produced by running the below command while inside the go-ethereum folder:  
  ```
  for file in $(find . -type f);do printf "%50s\t%s\n" $file `echo "$file" | awk 'BEGIN{FS="/"}{print $NF}'`; done | grep -v "\.git.*" > georzaza_scripts/filenames
  ```
- ### `other/filtered_filenames.sh`:
  Produces the below.

- ### `other/filtered_filenames`:

  This file was produced by copying and running the script `other/filtered_filenames.sh` **in the go-ethereum-0.7.10 project**. The contents of the aforementioned script are displayed and explained here for the completeness purposes. Note that copy-pasting the below command **will not work**. Although the actual command in the file is a one liner, here it is presented into multiple lines for better comprehension. 
  ```
  #!/bin/bash

  # for every file in the folder print 2 things
  # 1. the substring of the filepath string (starting at index 2)
  # 2. the substring of the filepath string that starts after the last
  #    occurence of the character "/" (aka the filename without it's path location)
  
  for file in $(find . -type f); do 
	printf "%s:%s\n" ${file:2} `echo "$file" | awk 'BEGIN { FS="/" } {print $NF} '`; 
  done

  # pipe the output of the above for to grep and filter out some files (eg any git files)
  |  grep -v "LICENSE$\|TODO$\|georzaza\|png$\|^\.git\|gitignore\|\.qml$\|\.js$\|\.html$\|\.cov$\|\.css$\|\.ethtest$\|\.sh$\|test\.go\>\|\.json$\|\.txt$\|\.md$\|\.yml$\|Dockerfile\|^_data\/chain"

  # pipe the output of grep to awk and print the files again, using different format.
  |  awk 'BEGIN {FS=":"} {printf "%50s\t\t%s\n",$1,$2}' 

  # sort the above output and finally export it to a file under georzaza_scripts directory. 
  |  sort -k2 > georzaza_scripts/filtered_filenames
  ```

  <br>

  The main purpose of the above command is to get a sorted by file**name** list of all files along with their location. The produced output will look like this:
  ```
  !head -n 10 filtered_filenames
                                     vm/address.go		address.go
                                    vm/analysis.go		analysis.go
                                       core/asm.go		asm.go
                                         vm/asm.go		asm.go
                                    ethutil/big.go		big.go
                              cmd/mist/bindings.go		bindings.go
                               core/types/block.go		block.go
                                   pow/ar/block.go		block.go
                                      pow/block.go		block.go
                             core/block_manager.go		block_manager.go
  ``

<br>
